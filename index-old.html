<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlArab GPT-7 Local Experience</title>
<style>
body {
  margin:0; padding:0; font-family:'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#0f0f0f,#1a1a1a);
  overflow:hidden; height:100vh; display:flex; justify-content:center; align-items:center;
}
#chat-container {
  width:90%; max-width:700px; padding:30px;
  background: rgba(255,255,255,0.05); backdrop-filter: blur(20px) saturate(180%);
  border-radius:25px; border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 0 50px rgba(255,215,0,0.3);
  display:flex; flex-direction:column; position:relative;
}
#messages {
  height:400px; overflow-y:auto; padding:15px; margin-bottom:20px;
  border-radius:20px; background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);
  box-shadow: inset 0 0 15px rgba(255,255,255,0.05);
}
.message {margin-bottom:15px; padding:10px 15px; border-radius:15px; max-width:80%; animation: fadeIn 0.4s;}
.user {background: rgba(74,163,255,0.3); color:#fff; align-self:flex-end;}
.ai {background: rgba(255,215,0,0.2); color:#ffd700; align-self:flex-start;}
@keyframes fadeIn {from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
#input-container {display:flex; gap:10px;}
#user-input {
  flex:1; padding:12px; border-radius:15px; border:none; outline:none;
  background: rgba(255,255,255,0.05); color:#fff; backdrop-filter: blur(10px);
}
#send-btn {
  padding:12px 25px; border-radius:15px; border:none; background:#ffd700; cursor:pointer;
  font-weight:bold; transition:0.3s;
}
#send-btn:hover {background:#ffc107; transform:scale(1.05);}
#particles {position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;}
</style>
</head>
<body>

<canvas id="particles"></canvas>

<div id="chat-container">
  <div id="messages"></div>
  <div id="input-container">
    <input type="text" id="user-input" placeholder="اكتب رسالتك هنا...">
    <button id="send-btn">إرسال</button>
  </div>
</div>

<script>
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

// ✅ Ollama Local API
const API_URL = 'http://localhost:11434/api/chat';

function appendMessage(sender, text){
  const msgEl = document.createElement('div');
  msgEl.className = 'message ' + sender;
  msgEl.textContent = text;
  messagesEl.appendChild(msgEl);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

async function sendMessage(){
  const userMessage = inputEl.value.trim();
  if(!userMessage) return;
  appendMessage('user','أنت: ' + userMessage);
  inputEl.value='';
  try{
    const response = await fetch(API_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        model:'llama3',
        messages:[{role:'user', content:userMessage}]
      })
    });
    const reader = response.body.getReader();
    let decoder = new TextDecoder();
    let buffer = "";
    while(true){
      const {done, value} = await reader.read();
      if(done) break;
      buffer += decoder.decode(value,{stream:true});
      try{
        const json = JSON.parse(buffer.trim().split("\\n").pop());
        if(json.message && json.message.content){
          appendMessage('ai','العرّاب GPT-7: ' + json.message.content);
          const utterance = new SpeechSynthesisUtterance(json.message.content);
          utterance.lang='ar-SA'; speechSynthesis.speak(utterance);
        }
      }catch{}
    }
  }catch(err){
    appendMessage('ai','⚠️ خطأ: ' + err.message);
  }
}

sendBtn.addEventListener('click',sendMessage);
inputEl.addEventListener('keypress',e=>{if(e.key==='Enter') sendMessage();});

// ✨ Simple Particles
const canvas=document.getElementById('particles');const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
const particles=[];for(let i=0;i<50;i++){particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*3+1,speed:Math.random()*1+0.2});}
function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let p of particles){ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle='rgba(255,215,0,0.6)';ctx.fill();p.y-=p.speed;if(p.y<0)p.y=canvas.height;}requestAnimationFrame(animate);}animate();
window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});
</script>

</body>
</html>
